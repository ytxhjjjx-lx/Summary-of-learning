# 微信开发

## 微信开发

**1.微信公众平台**

​		运营者通过公众号为微信用户提供资讯和服务的平台。

<img src="/Users/tangxiangrong/Desktop/windows/nodejs全栈开发/php/5F392C7C-2F09-4412-B7F0-40056D6487D3.png" width="500"/>

### 基本概念

**侧重功能：**

1、服务号侧重于对用户进行服务；

2、订阅号侧重于信息传播；

3、企业号侧重于生产运营管理；

**适用范围：**

1、服务号主要适用于媒体、企业、政府或其他有需求的组织；

2、订阅号主要适用于个人、媒体、企业、政府或其他有需求的组织；

3、企业号主要适用于企业、政府、事业单位或其他有需求的组织；

其实还是按申请者需求来定了，没有强制说谁谁一定的使用哪种服务号

**推送消息显示地方：**

1、服务号和企业号推送的消息，直接显示在微信对话列表中；

2、订阅号推送的消息，显示在微信对话列表中“订阅号”文件夹中；

**推送消息的限制次数：**

1、服务号每月4条；

2、订阅号每天1条；

3、企业号每分钟200次;

**关注者验证：**

1、服务号和订阅号可以被任何微信用户扫码关注；

2、企业号只有通讯录成员可关注；

****

**高级接口功能：**

1、订阅号不支持；

2、服务号和企业号通过认证之后支持**；**

**微信支付功能：**

1、订阅号无微信支付功能；

2、服务号和企业号通过认证之后支持微信支付功能；

### 公众号两种服务模式

1、公众号消息会话

​	这种模式下，公众号是以微信用户一个联系人形式存在的。可以回复微信用户信息，可以定制公众号的菜单，可以处理菜单的点击事件等。

   

**2、公众号内网页**

​	比较复杂的业务场景，需要通过网页形式来提供服务。

网页授权获取用户基本信息、使用微信JS-SDK调用一些硬件功能。

### 前期准备工作

**1.先创建一个微信公众帐号（个人一般申请订阅号）**

​	

**2.准备一个服务器用于处理微信转发过来的信息或事件（可以使用新浪SAE，新浪平台需要进行实名认证，审核周期3个工作日，并非3个自然日）**

****

**3.配置环境，配置公众号对应的服务器地址**

## 微信开发配置

**配置自己的服务器地址（即新浪云地址）**

**微信公众平台->开发者工具->公众平台测试账号->接口配置信息**

****

**URL:**服务器存放设置token的地址，例如:http://tangcaiye.applinzi.com/weixin/index.php

**token：**验证index.php文件里的token值

解释：index.php文件可以从** 开发者文档->开始开发->接入指南 **中找到PHP示例代码下载

****

​	

### js接口安全域名配置

**微信JS-SDK是微信公众平台面向网页开发者提供的基于微信内的网页开发工具包**

**域名配置：**需要填写网站一级域名，在此域名下开发的网页都可以使用微信开放出来的接口，例如：[**baidu.com**](http://baidu.com)

详细使用过程请参照微信JS-SDK说明文档

**开发者文档->微信网页开发->微信JS-SDK说明文档**



## 微信开发实例

### 开发者规范

1、接口有接口权限和调用频次（测试帐号不限）。

2、收集用户数据需要征得用户同意。

3、收集的用户信息不得泄露出去。

4、不得发布违反法规、公序良俗等内容。

5、不是公开表达或暗示您与腾讯的合作关系。

### 开发者支持

为了帮助开发者完成微信相关的开发，微信公众平台提供了一些支持：

1、开发者文档

2、在线接口调试工具

3、web开发者工具

4、公众平台测试帐号

### access_token

**在微信开发中，所有的API接口都有一个公共参数access_token，access_token是有有效期的（7200s）。**

**有API接口可以获取access_token，获取新access_token的时候，现有的access_token会失效。**

**获取access_token的API接口是有调用次数的，因此需要我们存储好我们的access_token。**

### 获取access_token

其他接口的调用都是基于access_token，所以需先获取access_token

获取access_token方法：

http请求方式: GET

请求接口：https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=APPID&secret=APPSECRET

参数说明：

参数	是否必须	说明

grant_type	是	获取access_token填写client_credential

appid	是	第三方用户唯一凭证

secret	是	第三方用户唯一凭证密钥，即appsecret

由于此接口每天有2000次的请求限制，每次请求到的可用时效为2个小时，所以可以先进行存储，失效后再请求

### 1.获取微信服务器IP地址

获取微信服务器IP地址方法：

http请求方式: GET

请求接口：https://api.weixin.qq.com/cgi-bin/getcallbackip?access_token=ACCESS_TOKEN

参数说明：

参数	是否必须	说明

access_token	是	公众号的access_token

### 2.获取用户列表

获取用户列表方法：

http请求方式: GET

请求接口：https://api.weixin.qq.com/cgi-bin/user/get?access_token=ACCESS_TOKEN&next_openid=NEXT_OPENID

参数说明：

参数	是否必须	说明

access_token	是	调用接口凭证

next_openid	是	第一个拉取的OPENID，不填默认从头开始拉取

### 3.获取用户基本信息

获取用户列表方法：

http请求方式: GET

请求接口：https://api.weixin.qq.com/cgi-bin/user/info?access_token=ACCESS_TOKEN&openid=OPENID&lang=zh_CN

参数说明：

参数	是否必须	说明

access_token	是	调用接口凭证

openid	是	普通用户的标识，对当前公众号唯一

lang	否	返回国家地区语言版本，zh_CN 简体，zh_TW 繁体，en 英语

##微信JS-SDK

使用步骤：

步骤一：绑定域名

步骤二：引入JS文件

步骤三：通过config接口注入权限验证配置

步骤四：通过ready接口处理成功验证

步骤五：通过error接口处理失败验证

### JS-SDK接口调用说明

所有接口通过wx对象来调用，参数是一个对象，除了每个接口本身需要传的参数之外，还有以下通用参数：

1.success：接口调用成功时执行的回调函数。

2.fail：接口调用失败时执行的回调函数。

3.complete：接口调用完成时执行的回调函数，无论成功或失败都会执行。

4.cancel：用户点击取消时的回调函数，仅部分有用户取消操作的api才会用到。

5.trigger: 监听Menu中的按钮点击时触发的方法，该方法仅支持Menu中的相关接口。

### JS-SDK接口使用练习

请参照微信JS-SDK说明文档

1.分享到微信朋友圈

2.分享给微信好友

3.图像接口（选择图片、预览图片、上传图片、下载图片）

4.音频接口（开始录音、停止录音、播放录音）

5.地理位置（获取地理位置、使用微信内置地图查看位置）

6.微信扫一扫

